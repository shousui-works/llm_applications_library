name: Setup Repository Labels

on:
  workflow_dispatch: # æ‰‹å‹•å®Ÿè¡Œã®ã¿

permissions:
  issues: write

jobs:
  setup-labels:
    runs-on: ubuntu-latest

    steps:
    - name: Setup Version Labels
      uses: actions/github-script@v7
      with:
        github-token: ${{ secrets.GITHUB_TOKEN }}
        script: |
          const labels = [
            // ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒãƒ³ãƒ—ç”¨ãƒ©ãƒ™ãƒ«
            {
              name: 'major',
              color: 'D73A4A',
              description: 'ãƒ¡ã‚¸ãƒ£ãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆç ´å£Šçš„å¤‰æ›´ï¼‰'
            },
            {
              name: 'minor',
              color: '0075CA',
              description: 'ãƒã‚¤ãƒŠãƒ¼ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆæ–°æ©Ÿèƒ½è¿½åŠ ï¼‰'
            },
            {
              name: 'patch',
              color: '7057FF',
              description: 'ãƒ‘ãƒƒãƒãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆãƒã‚°ä¿®æ­£ãƒ»å°æ”¹å–„ï¼‰'
            },

            // æ©Ÿèƒ½åˆ†é¡ãƒ©ãƒ™ãƒ«
            {
              name: 'feature',
              color: '0E8A16',
              description: 'æ–°æ©Ÿèƒ½ã®è¿½åŠ '
            },
            {
              name: 'bugfix',
              color: 'D73A4A',
              description: 'ãƒã‚°ä¿®æ­£'
            },
            {
              name: 'hotfix',
              color: 'B60205',
              description: 'ç·Šæ€¥ä¿®æ­£'
            },
            {
              name: 'documentation',
              color: '0052CC',
              description: 'ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ›´æ–°'
            },
            {
              name: 'test',
              color: 'FBCA04',
              description: 'ãƒ†ã‚¹ãƒˆã®è¿½åŠ ãƒ»ä¿®æ­£'
            },
            {
              name: 'maintenance',
              color: 'F9D0C4',
              description: 'ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ãƒ»ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°'
            },

            // ãã®ä»–ã®ã‚«ãƒ†ã‚´ãƒª
            {
              name: 'ci/cd',
              color: '1F883D',
              description: 'CI/CDã®æ”¹å–„'
            },
            {
              name: 'dependencies',
              color: '0366D6',
              description: 'ä¾å­˜é–¢ä¿‚ã®æ›´æ–°'
            },
            {
              name: 'breaking-change',
              color: 'B60205',
              description: 'ç ´å£Šçš„å¤‰æ›´ã‚’å«ã‚€'
            }
          ];

          for (const label of labels) {
            try {
              // æ—¢å­˜ã®ãƒ©ãƒ™ãƒ«ã‚’ãƒã‚§ãƒƒã‚¯
              const existing = await github.rest.issues.getLabel({
                owner: context.repo.owner,
                repo: context.repo.repo,
                name: label.name
              });

              // æ—¢å­˜ã®ãƒ©ãƒ™ãƒ«ã‚’æ›´æ–°
              await github.rest.issues.updateLabel({
                owner: context.repo.owner,
                repo: context.repo.repo,
                name: label.name,
                color: label.color,
                description: label.description
              });

              console.log(`âœ… Updated label: ${label.name}`);

            } catch (error) {
              if (error.status === 404) {
                // ãƒ©ãƒ™ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯æ–°è¦ä½œæˆ
                await github.rest.issues.createLabel({
                  owner: context.repo.owner,
                  repo: context.repo.repo,
                  name: label.name,
                  color: label.color,
                  description: label.description
                });

                console.log(`ğŸ†• Created label: ${label.name}`);
              } else {
                console.log(`âŒ Error with label ${label.name}:`, error.message);
              }
            }
          }

          console.log('ğŸ‰ Label setup completed!');